# Сети Точка-точка

В этой главе мы рассмотрим следующее:
* Минимально допустимые настройки
* Секретные ключи OpenVPN
* Несколько секретных ключей
* Туннель открытого текста
* Маршрутизация
* Конфигурационные файлы в сравнении с командной строкой
* IP-минимальная конфигурация
* Полная настройка между местоположениями
* Трехсторонняя маршрутизация
* Использование IPv6

## Вступление

Рецепты в этой главе будут содержать введение в настройку OpenVPN. Они основаны на типе сети Точка-точка, что означает, что только один клиент может подключиться в данный момент времени.

Двухточечная сеть очень полезна при подключении к небольшому числу местположений или клиентов. Это проще настроить, так как не требуется никаких сертификатов или **инфраструктуры открытых ключей (PKI)**. Кроме того, маршрутизацию немного легче настроить, так как не требуется никаких специфичных для клиента конфигурационных файлов, содержащих инструкции `--iroute`.

Недостатки двухточечной сети заключаются в следующем:

*	Отсутствие совершенной прямой секретности-ключевой компромисс может привести к полному раскрытию предыдущих сессий.
* Секретный ключ должен существовать в виде открытого текста на каждом узле VPN

## Кратчайшая возможная настройка

Этот рецепт объясняет минимальные возможные настройки при использовании OpenVPN. Для этого вам нужно подключить компьютер (локальная сеть или Интернет). Мы будем использовать TUN или TAP и сосредоточимся на различиях между ними. Устройство TUN используется в основном для VPN-туннелей, где используется только IP-трафик. Устройство TAP позволяет передавать все кадры Ethernet через туннель OpenVPN, что обеспечивает поддержку протоколов не на основе IP, таких как IPX и AppleTalk.

Это может показаться бесполезным для быстрой проверки возможности подключения OpenVPN к удаленной системе.

### Подготовка

Установите OpenVPN 2.3.9 или выше на двух компьютерах. Убедитесь, что компьютеры подключены по сети. Сервер под управлением Windows 7 Pro 64bit и OpenVPN 2.3.10 работал под управлением CentOS 6 Linux и OpenVPN 2.3.9.

### Как это сделать ...

Вот шаги, которые вы должны выполнить:

1. Запустить процесс OpenVPN на стороне сервера (прослушивание) для сети в стиле TUN:

```
[root@server]# openvpn --ifconfig 10.200.0.1 10.200.0.2 \
--dev tun
```

---

**Примечание**

Предыдущая команда должна быть введена в одну строку. Символ `\` используется для продолжения команды на следующей строке.

---

2. Затем запустите клиентский процесс OpenVPN:
```
[WinClient] C:\>"\Program Files\OpenVPN\bin\openvpn.exe" \
--ifconfig 10.200.0.2 10.200.0.1 --dev tun \
--remote openvpnserver.example.com
```

Следующий снимок экрана показывает, как устанавливается соединение:

![](pics/pic1-1)

Мы можем пропинговать другой конец туннеля.

3. Когда вы остановитесь в туннеле, используйте функциональную клавишу _F4_ в командном окне и перезапустите оба конца туннеля с помощью устройства TAP.

4. Запустить процесс OpenVPN на стороне сервера (прослушивание) для сети в стиле TAP:

```
[root@server]# openvpn --ifconfig 10.200.0.1 255.255.255.0 \
--dev tap
```

5. Затем запустите клиентский процесс OpenVPN:

```
[WinClient] C:\>"
\Program Files\OpenVPN\bin\openvpn.exe" \
--ifconfig 10.200.0.2 255.255.255.0 --dev tap \
--remote openvpnserver.example.com
```

Соединение будет установлено, и мы снова сможем пропинговать другой конец туннеля.

### Как это работает...

Сервер прослушивает UDP-порт `1194`, который является портом OpenVPN по умолчанию для входящих соединений. Клиент подключается к серверу через этот порт. После первоначального рукопожатия сервер настраивает первое доступное устройство TUN с IP-адресом `10.200.0.1` и ожидает, что удаленный конец (адрес узла) будет `10.200.0.2`.

Клиент делает наоборот: после первоначального рукопожатия первого устройства TUN или TAP-Win32 настраивается с IP-адресом `10.200.0.2`. Ожидается, что удаленный конец (адрес узла) будет `10.200.0.1`. После этого VPN устанавливается.

**Заметка**

Обратите внимание на предупреждение:

** \*\*\*\*\*\*\* WARNING \*\*\*\*\*\*\*: all encryption and authentication features disabled — all data will be tunnelled as cleartext**

******* ПРЕДУПРЕЖДЕНИЕ *******: все функции шифрования и аутентификации отключены - все данные будут передаваться в виде открытого текста

Здесь данные не защищены: все данные, которые отправляются через VPN-туннель, могут быть прочитаны!

### Есть больше ...

Давайте рассмотрим несколько различных сценариев и проверим - изменят ли они этот процесс.
